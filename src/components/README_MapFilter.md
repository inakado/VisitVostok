# MapFilter Component

Компонент фильтрации для карты мест на главной странице VisitVostok.

## Функциональность

### Основные фильтры:
- **Поиск** - по названию места, адресу или городу (с debounce 300мс для устранения мерцания)
- **Слайдер популярности** - фильтрация по рейтингу (0-100%)

### Категории:
- **Иерархическая структура** - основные категории (categoryName) и подкатегории (categories) из БД
- **Счетчики мест** - показывает количество мест в каждой категории
- **Раскрывающиеся списки** - подкатегории управляются через состояние
- **11 основных категорий**:
  1. Природа (водопады, пляжи, горы, пещеры, озёра, реки, каньоны и скалы, заповедники и нац. парки, источники, панорамные виды)
  2. История и культура (архитектура, замки и крепости, памятники и мемориалы, башни и смотровые, мосты, фонтаны, археология, скульптуры, площади)
  3. Музеи и выставки (исторические, военные, художественные, технические, природоведческие, дом-музеи, под открытым небом, планетарии/обсерватории, прочие музеи)
  4. Парки и животные
  5. Развлечения и досуг
  6. Спорт и активный отдых
  7. Религия
  8. Проживание
  9. Транспорт и сервис
  10. Покупки и рынки
  11. Прочее

### Табы:
- **Каталог** - основная фильтрация (реализовано)
- **Список** - будущий функционал списочного вида
- **Избранное** - будущий функционал избранных мест
- **Маршрут** - будущий планировщик маршрутов

## Оптимизация производительности

### Устранение мерцания:
- **Debounce поиска** - 300мс задержка для поискового запроса
- **Мемоизация фильтрации** - useMemo для filteredPlaces
- **Оптимизированные колбэки** - useCallback для функций обновления
- **Раздельное состояние** - debounced и обычное состояние поиска

### Управление состоянием:
- **Локальное состояние раскрытия** - Set для отслеживания раскрытых категорий
- **Кэшированные категории** - загрузка один раз из API
- **Мемоизированные вычисления** - пересчет только при изменении зависимостей

## Адаптивность

### Десктоп (lg+):
- Полная панель всегда видна
- Размер: max-width 384px (max-w-sm)
- Позиция: top-20 (отступ от хэдера)

### Мобильные устройства (< lg):
- Компактная кнопка "Фильтры" с счетчиком активных фильтров
- Разворачивается в полную панель при клике
- Возможность скрыть панель кнопкой "X"
- Позиция: top-20 (отступ от хэдера)

## База данных

### Модель Category (Prisma):
```prisma
model Category {
  id            String   @id @default(cuid())
  name          String   @unique
  subcategories String[]
  description   String?
  icon          String?
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
```

### API эндпоинт:
- `GET /api/categories` - получение всех категорий, отсортированных по order

## Интеграция

### Используемые хуки:
- `useMapFilters(places)` - основная логика фильтрации и состояние
- Включает debounce, загрузку категорий, мемоизацию

### Типы:
- `MapFilters` - состояние фильтров (убран onlyHeritage)
- `CategoryWithSubcategories` - структура категорий с состоянием раскрытия
- `FilterTab` - типы табов
- `Category` - Prisma модель категории

### Связь с картой:
- Фильтрованные места передаются в `MapLibreMap`
- Изменения фильтров обновляют карту без мерцания
- Debounced поиск для плавности

## Изменения от предыдущей версии:

### Убрано:
- ❌ Чекбокс "Только объекты наследия"
- ❌ Мерцание при фильтрации и поиске
- ❌ Статическая структура категорий из кода

### Добавлено:
- ✅ База данных для категорий и подкатегорий
- ✅ Debounce для поиска (300мс)
- ✅ Мемоизация и оптимизация производительности
- ✅ Правильные отступы от хэдера (top-20)
- ✅ API для загрузки категорий
- ✅ Управление состоянием раскрытия категорий
- ✅ 11 категорий с 80+ подкатегориями

## Файлы:
- `src/components/MapFilter.tsx` - основной компонент
- `src/lib/hooks/useMapFilters.ts` - хук логики фильтрации (оптимизированный)
- `src/types/index.ts` - типы фильтров (обновленные)
- `src/app/ClientHomePage.tsx` - интеграция в главную страницу
- `src/app/api/categories/route.ts` - API категорий
- `prisma/schema.prisma` - модель Category
- `prisma/seed-categories.ts` - заполнение категорий 